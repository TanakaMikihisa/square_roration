<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£æ–¹å½¢ã®å›è»¢é‹å‹•ã®å¯è¦–åŒ–</title>
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tanakamikihisa.github.io/Square_Rotation_Visualization/">
    <meta property="og:title" content="æ­£æ–¹å½¢ã®å›è»¢é‹å‹•ã®å¯è¦–åŒ– - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ•°å­¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³">
    <meta property="og:description" content="æ­£æ–¹å½¢ã®å›è»¢é‹å‹•ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¯è¦–åŒ–ã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª¿æ•´ã—ã¦è¤‡é›‘ãªè»Œè·¡ã‚’æãæ•°å­¦çš„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½“é¨“ã—ã‚ˆã†ã€‚">
    <!-- <meta property="og:image" content="https://tanakamikihisa.github.io/Square_Rotation_Visualization/preview-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630"> -->
    <meta property="og:site_name" content="Square Rotation Visualization">
    <meta property="og:locale" content="ja_JP">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tanakamikihisa.github.io/Square_Rotation_Visualization/">
    <meta property="twitter:title" content="æ­£æ–¹å½¢ã®å›è»¢é‹å‹•ã®å¯è¦–åŒ– - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ•°å­¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³">
    <meta property="twitter:description" content="æ­£æ–¹å½¢ã®å›è»¢é‹å‹•ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¯è¦–åŒ–ã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª¿æ•´ã—ã¦è¤‡é›‘ãªè»Œè·¡ã‚’æãæ•°å­¦çš„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½“é¨“ã—ã‚ˆã†ã€‚">
    <!-- <meta property="twitter:image" content="https://tanakamikihisa.github.io/Square_Rotation_Visualization/preview-image.png"> -->
    <meta property="twitter:creator" content="@mathmeganekun">
    <meta property="twitter:site" content="@mathmeganekun">
    
    <!-- Additional SEO meta tags -->
    <meta name="description" content="æ­£æ–¹å½¢ã®å›è»¢é‹å‹•ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¯è¦–åŒ–ã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª¿æ•´ã—ã¦è¤‡é›‘ãªè»Œè·¡ã‚’æãæ•°å­¦çš„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½“é¨“ã—ã‚ˆã†ã€‚">
    <meta name="keywords" content="æ•°å­¦, å¯è¦–åŒ–, å›è»¢é‹å‹•, æ­£æ–¹å½¢, ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³, ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–, è»Œè·¡, å¹¾ä½•å­¦">
    <meta name="author" content="Tanaka Mikihisa">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .control-group {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        .control-group .value {
            font-size: 14px;
            color: #6c757d;
            text-align: center;
        }
        .sync-control {
            background-color: #e8f5e8;
            border-color: #4caf50;
        }
        .sync-control label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: #2e7d32;
        }
        .sync-control input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        .snap-control {
            background-color: #fff3e0;
            border-color: #ff9800;
        }
        .snap-control label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: #e65100;
        }
        .snap-control input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        canvas {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
            background-color: white;
        }
        .info {
            margin-top: 20px;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }
        .info h3 {
            margin-top: 0;
            color: #1976d2;
        }
        .info p {
            margin: 5px 0;
            color: #424242;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ­£æ–¹å½¢ã®å›è»¢é‹å‹•ã®å¯è¦–åŒ–</h1>
        
        <div class="controls">
            <div class="control-group">
                <label for="r">r (æ­£æ–¹å½¢ã®åŠå¾„):</label>
                <input type="range" id="r" min="0.5" max="3" step="0.1" value="1.5">
                <div class="value" id="r-value">1.5</div>
            </div>
            
            <div class="control-group">
                <label for="l">â„“ (ç‚¹Iã®xåº§æ¨™):</label>
                <input type="range" id="l" min="0.5" max="4" step="0.1" value="2">
                <div class="value" id="l-value">2.0</div>
            </div>
            
            <div class="control-group">
                <label for="theta">Î¸ (ç‚¹Iã®å›è»¢è§’):</label>
                <input type="range" id="theta" min="0" max="6.28318" step="0.01" value="0">
                <div class="value" id="theta-value">0.00 rad (0.0Â°)</div>
            </div>
            
            <div class="control-group">
                <label for="phi">Ï† (æ­£æ–¹å½¢ã®å›è»¢è§’):</label>
                <input type="range" id="phi" min="0" max="6.28318" step="0.01" value="0">
                <div class="value" id="phi-value">0.00 rad (0.0Â°)</div>
            </div>
            
            <div class="control-group sync-control">
                <label>
                    <input type="checkbox" id="sync-toggle"> Î¸ã¨Ï†ã‚’åŒæœŸ
                </label>
            </div>
            
            <div class="control-group" id="ratio-group" style="display: none;">
                <label for="ratio">Ï†/Î¸ ã®æ¯”ç‡:</label>
                <input type="range" id="ratio" min="-3" max="3" step="0.01" value="1">
                <div class="value" id="ratio-value">1.00</div>
            </div>
            
            
            <div class="control-group" style="background-color: #e8f5e8; border-color: #4caf50;">
                <button id="toggle-trajectory" style="width: 100%; padding: 10px; background-color: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 5px;">
                    è»Œè·¡ã‚’è¡¨ç¤º
                </button>
                <button id="clear-trajectory" style="width: 100%; padding: 10px; background-color: #ff9800; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 5px;">
                    è»Œè·¡ã‚’ã‚¯ãƒªã‚¢
                </button>
            </div>
        </div>
        
        <canvas id="canvas" width="800" height="600"></canvas>
        
        
        <div class="info" style="background-color: #f8f9fa; border-left: 4px solid #6c757d;">
            <h3>ğŸ‘¨â€ğŸ’» é–‹ç™ºè€…ã«ã¤ã„ã¦</h3>
            <p><strong>é–‹ç™ºè€…:</strong> Tanaka Mikihisa</p>
            <p><strong>X:</strong> <a href="https://x.com/mathmeganekun?s=11" target="_blank" style="color: #1da1f2; text-decoration: none;">@mathmeganekun</a></p>
            <p><strong>GitHub:</strong> <a href="https://github.com/TanakaMikihisa/square_rotation_visualization" target="_blank" style="color: #1da1f2; text-decoration: none;">Square_rotation_visualization</a></p>
        </div>
    </div>

    <script>
        class SquareRotationVisualizer {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.width = this.canvas.width;
                this.height = this.canvas.height;
                
                // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
                this.r = 1.5;
                this.l = 2.0;
                this.theta = 0;
                this.phi = 0;
                this.syncEnabled = false;
                this.ratio = 1.0;
                
                // é€šéé¢ç©ã®è»Œè·¡ã‚’è¨˜éŒ²
                this.trajectoryPoints = [];
                this.maxTrajectoryPoints = 1000; // è»Œè·¡ã®æœ€å¤§ç‚¹æ•°
                this.showTrajectory = false; // è»Œè·¡è¡¨ç¤ºã®çŠ¶æ…‹
                
                this.setupEventListeners();
                this.draw();
            }
            
            setupEventListeners() {
                const sliders = ['r', 'l', 'theta', 'phi', 'ratio'];
                sliders.forEach(id => {
                    const slider = document.getElementById(id);
                    const valueDisplay = document.getElementById(id + '-value');
                    
                    slider.addEventListener('input', (e) => {
                        let value = parseFloat(e.target.value);
                        
                        
                        this[id] = value;
                        
                        // è§’åº¦ã®å ´åˆã¯åº¦æ•°æ³•ã¨ãƒ©ã‚¸ã‚¢ãƒ³æ³•ã®ä¸¡æ–¹ã§è¡¨ç¤º
                        if (id === 'theta' || id === 'phi') {
                            this.updateAngleDisplay(id, this[id]);
                        } else {
                            valueDisplay.textContent = this[id].toFixed(2);
                        }
                        
                        // åŒæœŸãƒ¢ãƒ¼ãƒ‰ã§ã®ç›¸äº’æ›´æ–°
                        if (this.syncEnabled) {
                            if (id === 'theta') {
                                // Î¸ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€Ï†ã‚’è‡ªå‹•è¨ˆç®—
                                this.phi = this.theta * this.ratio;
                                document.getElementById('phi').value = this.phi;
                                this.updateAngleDisplay('phi', this.phi);
                            } else if (id === 'phi') {
                                // Ï†ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€Î¸ã‚’è‡ªå‹•è¨ˆç®—
                                this.theta = this.phi / this.ratio;
                                document.getElementById('theta').value = this.theta;
                                this.updateAngleDisplay('theta', this.theta);
                            } else if (id === 'ratio') {
                                // æ¯”ç‡ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€ç¾åœ¨ã®Î¸ã«åŸºã¥ã„ã¦Ï†ã‚’æ›´æ–°
                                this.phi = this.theta * this.ratio;
                                document.getElementById('phi').value = this.phi;
                                this.updateAngleDisplay('phi', this.phi);
                            }
                        }
                        
                        // è»Œè·¡ã‚’è¨˜éŒ²ï¼ˆè¡¨ç¤ºãŒæœ‰åŠ¹ãªå ´åˆã®ã¿ï¼‰
                        if (this.showTrajectory) {
                            this.recordTrajectory();
                        }
                        
                        this.draw();
                    });
                });
                
                // åŒæœŸãƒˆã‚°ãƒ«
                const syncToggle = document.getElementById('sync-toggle');
                const ratioGroup = document.getElementById('ratio-group');
                
                syncToggle.addEventListener('change', (e) => {
                    this.syncEnabled = e.target.checked;
                    ratioGroup.style.display = this.syncEnabled ? 'block' : 'none';
                    
                    if (this.syncEnabled) {
                        // åŒæœŸé–‹å§‹æ™‚ã€ç¾åœ¨ã®Î¸ã«åŸºã¥ã„ã¦Ï†ã‚’è¨­å®š
                        this.phi = this.theta * this.ratio;
                        document.getElementById('phi').value = this.phi;
                        const phiDegrees = (this.phi * 180 / Math.PI).toFixed(1);
                        document.getElementById('phi-value').textContent = `${this.phi.toFixed(2)} rad (${phiDegrees}Â°)`;
                    }
                    
                    this.draw();
                });
                
                // è»Œè·¡è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³
                const toggleButton = document.getElementById('toggle-trajectory');
                toggleButton.addEventListener('click', () => {
                    this.showTrajectory = !this.showTrajectory;
                    toggleButton.textContent = this.showTrajectory ? 'è»Œè·¡ã‚’éè¡¨ç¤º' : 'è»Œè·¡ã‚’è¡¨ç¤º';
                    toggleButton.style.backgroundColor = this.showTrajectory ? '#f44336' : '#4caf50';
                    this.draw();
                });
                
                // è»Œè·¡ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³
                const clearButton = document.getElementById('clear-trajectory');
                clearButton.addEventListener('click', () => {
                    this.clearTrajectory();
                    this.draw();
                });
                
            }
            
            
            // è§’åº¦è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
            updateAngleDisplay(id, value) {
                const valueDisplay = document.getElementById(id + '-value');
                const degrees = (value * 180 / Math.PI).toFixed(1);
                valueDisplay.textContent = `${value.toFixed(2)} rad (${degrees}Â°)`;
            }
            
            // è»Œè·¡ã‚’è¨˜éŒ²ã™ã‚‹é–¢æ•°
            recordTrajectory() {
                const vertices = this.getSquareVertices();
                const canvasVertices = vertices.map(v => this.toCanvasCoords(v.x, v.y));
                
                // ç¾åœ¨ã®æ­£æ–¹å½¢ã®é ‚ç‚¹ã‚’è»Œè·¡ã«è¿½åŠ 
                this.trajectoryPoints.push({
                    vertices: canvasVertices,
                    timestamp: Date.now()
                });
                
                // è»Œè·¡ã®ç‚¹æ•°ã‚’åˆ¶é™
                if (this.trajectoryPoints.length > this.maxTrajectoryPoints) {
                    this.trajectoryPoints.shift();
                }
            }
            
            // è»Œè·¡ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹é–¢æ•°
            clearTrajectory() {
                this.trajectoryPoints = [];
            }
            
            
            // åº§æ¨™å¤‰æ›: æ•°å­¦åº§æ¨™ç³»ã‹ã‚‰Canvasåº§æ¨™ç³»ã¸
            toCanvasCoords(x, y) {
                const centerX = this.width / 2;
                const centerY = this.height / 2;
                const scale = 80; // ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼
                return {
                    x: centerX + x * scale,
                    y: centerY - y * scale // Yè»¸ã‚’åè»¢
                };
            }
            
            // å›è»¢è¡Œåˆ—
            rotate(x, y, angle) {
                const cos = Math.cos(angle);
                const sin = Math.sin(angle);
                return {
                    x: x * cos - y * sin,
                    y: x * sin + y * cos
                };
            }
            
            // ç‚¹Iã®ä½ç½®ã‚’è¨ˆç®—
            getPointI() {
                // ç‚¹I(â„“, 0)ã‚’Î¸å›è»¢
                return this.rotate(this.l, 0, this.theta);
            }
            
            // è»¸Î±ã¨Î²ã®æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¨ˆç®—
            getAxes() {
                const pointI = this.getPointI();
                const axisAlpha = {
                    x: pointI.x,
                    y: pointI.y
                };
                
                // è»¸Î²ã¯è»¸Î±ã‚’Ï€/2å›è»¢
                const axisBeta = this.rotate(axisAlpha.x, axisAlpha.y, Math.PI / 2);
                
                return { alpha: axisAlpha, beta: axisBeta };
            }
            
            // æ­£æ–¹å½¢ã®é ‚ç‚¹ã‚’è¨ˆç®—
            getSquareVertices() {
                const pointI = this.getPointI();
                const axes = this.getAxes();
                
                // è»¸Î±ã¨Î²ã‚’æ­£è¦åŒ–
                const alphaLength = Math.sqrt(axes.alpha.x * axes.alpha.x + axes.alpha.y * axes.alpha.y);
                const betaLength = Math.sqrt(axes.beta.x * axes.beta.x + axes.beta.y * axes.beta.y);
                
                const alphaUnit = {
                    x: axes.alpha.x / alphaLength,
                    y: axes.alpha.y / alphaLength
                };
                const betaUnit = {
                    x: axes.beta.x / betaLength,
                    y: axes.beta.y / betaLength
                };
                
                // æ­£æ–¹å½¢ã®é ‚ç‚¹ï¼ˆè»¸Î±, Î²åº§æ¨™ç³»ã§ï¼‰
                const vertices = [
                    { x: this.r, y: 0 },   // P
                    { x: 0, y: -this.r },  // Q
                    { x: -this.r, y: 0 },  // R
                    { x: 0, y: this.r }    // S
                ];
                
                // Ï†å›è»¢ã‚’é©ç”¨
                const rotatedVertices = vertices.map(v => this.rotate(v.x, v.y, this.phi));
                
                // è»¸Î±, Î²åº§æ¨™ç³»ã‹ã‚‰é€šå¸¸ã®åº§æ¨™ç³»ã«å¤‰æ›
                return rotatedVertices.map(v => ({
                    x: pointI.x + v.x * alphaUnit.x + v.y * betaUnit.x,
                    y: pointI.y + v.x * alphaUnit.y + v.y * betaUnit.y
                }));
            }
            
            draw() {
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                // åº§æ¨™è»¸ã‚’æç”»
                this.drawAxes();
                
                // è»Œè·¡ã‚’æç”»ï¼ˆé€šéé¢ç©ï¼‰- è¡¨ç¤ºãŒæœ‰åŠ¹ãªå ´åˆã®ã¿
                if (this.showTrajectory) {
                    this.drawTrajectory();
                }
                
                // åŸç‚¹O
                const origin = this.toCanvasCoords(0, 0);
                this.ctx.fillStyle = '#2196f3';
                this.ctx.beginPath();
                this.ctx.arc(origin.x, origin.y, 6, 0, 2 * Math.PI);
                this.ctx.fill();
                
                // ç‚¹I
                const pointI = this.getPointI();
                const pointICanvas = this.toCanvasCoords(pointI.x, pointI.y);
                this.ctx.fillStyle = '#f44336';
                this.ctx.beginPath();
                this.ctx.arc(pointICanvas.x, pointICanvas.y, 6, 0, 2 * Math.PI);
                this.ctx.fill();
                this.ctx.fillStyle = '#000';
                this.ctx.fillText('I', pointICanvas.x + 10, pointICanvas.y + 5);
                
                // è»¸Î±ã¨Î²ã‚’æç”»
                this.drawAxesLines(pointI);
                
                // æ­£æ–¹å½¢ã‚’æç”»
                this.drawSquare();
            }
            
            drawAxes() {
                // Xè»¸
                this.ctx.strokeStyle = '#333';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.moveTo(0, this.height / 2);
                this.ctx.lineTo(this.width - 20, this.height / 2);
                this.ctx.stroke();
                
                // Xè»¸ã®çŸ¢å°
                this.drawArrow(this.width - 30, this.height / 2, this.width - 10, this.height / 2, '#333');
                
                // Yè»¸
                this.ctx.strokeStyle = '#333';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.moveTo(this.width / 2, 20);
                this.ctx.lineTo(this.width / 2, this.height);
                this.ctx.stroke();
                
                // Yè»¸ã®çŸ¢å°
                this.drawArrow(this.width / 2, 30, this.width / 2, 10, '#333');
                
                // Xè»¸ã®ãƒ©ãƒ™ãƒ«
                this.ctx.fillStyle = '#333';
                this.ctx.font = '14px Arial';
                this.ctx.fillText('x', this.width - 20, this.height / 2 - 10);
                
                // Yè»¸ã®ãƒ©ãƒ™ãƒ«
                this.ctx.fillText('y', this.width / 2 + 10, 20);
                
                // åŸç‚¹ã®ãƒ©ãƒ™ãƒ«
                this.ctx.fillText('O', this.width / 2 + 5, this.height / 2 - 5);
            }
            
            drawAxesLines(pointI) {
                const axes = this.getAxes();
                const pointICanvas = this.toCanvasCoords(pointI.x, pointI.y);
                
                // è»¸Î²ï¼ˆÎ±ã‚’Ï€/2å›è»¢ï¼‰ã®é•·ã•ã‚’å®šç¾©
                const axisBetaLength = 0.5; // Î²è»¸ã®é•·ã•ï¼ˆæ•°å­¦åº§æ¨™ç³»ã§ã®é•·ã•ï¼‰
                const betaEnd = this.toCanvasCoords(
                    pointI.x + axes.beta.x * axisBetaLength,
                    pointI.y + axes.beta.y * axisBetaLength
                );
                
                // è»¸Î±ï¼ˆOâ†’Iæ–¹å‘ï¼‰ã‚’Î²è»¸ã¨åŒã˜é•·ã•ã«èª¿æ•´
                const axisAlphaLength = axisBetaLength; // Î²è»¸ã¨åŒã˜é•·ã•
                const alphaEnd = this.toCanvasCoords(
                    pointI.x + axes.alpha.x * axisAlphaLength,
                    pointI.y + axes.alpha.y * axisAlphaLength
                );
                
                // è»¸Î±ã‚’æç”»
                this.ctx.strokeStyle = '#2196f3';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.moveTo(this.width / 2, this.height / 2);
                this.ctx.lineTo(alphaEnd.x, alphaEnd.y);
                this.ctx.stroke();
                
                // è»¸Î±ã®çŸ¢å°ã‚’æç”»
                this.drawArrow(this.width / 2, this.height / 2, alphaEnd.x, alphaEnd.y, '#2196f3');
                
                // è»¸Î²ã‚’æç”»
                this.ctx.strokeStyle = '#f44336';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.moveTo(pointICanvas.x, pointICanvas.y);
                this.ctx.lineTo(betaEnd.x, betaEnd.y);
                this.ctx.stroke();
                
                // è»¸Î²ã®çŸ¢å°ã‚’æç”»
                this.drawArrow(pointICanvas.x, pointICanvas.y, betaEnd.x, betaEnd.y, '#f44336');
                
                // è»¸ã®ãƒ©ãƒ™ãƒ« - ã‚ˆã‚Šé©åˆ‡ãªä½ç½®ã«é…ç½®
                this.ctx.fillStyle = '#2196f3';
                this.ctx.font = '12px Arial';
                this.ctx.fillText('Î±', alphaEnd.x + 5, alphaEnd.y - 5);
                
                this.ctx.fillStyle = '#f44336';
                this.ctx.fillText('Î²', betaEnd.x + 5, betaEnd.y - 5);
            }
            
            // çŸ¢å°ã‚’æç”»ã™ã‚‹é–¢æ•°
            drawArrow(fromX, fromY, toX, toY, color) {
                const headLength = 15; // çŸ¢å°ã®é•·ã•
                const headAngle = Math.PI / 6; // çŸ¢å°ã®è§’åº¦ï¼ˆ30åº¦ï¼‰
                
                // çŸ¢å°ã®æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«
                const dx = toX - fromX;
                const dy = toY - fromY;
                const angle = Math.atan2(dy, dx);
                
                // çŸ¢å°ã®å…ˆç«¯ã®åº§æ¨™
                const arrowX1 = toX - headLength * Math.cos(angle - headAngle);
                const arrowY1 = toY - headLength * Math.sin(angle - headAngle);
                const arrowX2 = toX - headLength * Math.cos(angle + headAngle);
                const arrowY2 = toY - headLength * Math.sin(angle + headAngle);
                
                // çŸ¢å°ã‚’æç”»
                this.ctx.strokeStyle = color;
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.moveTo(toX, toY);
                this.ctx.lineTo(arrowX1, arrowY1);
                this.ctx.moveTo(toX, toY);
                this.ctx.lineTo(arrowX2, arrowY2);
                this.ctx.stroke();
            }
            
            // è»Œè·¡ï¼ˆé€šéé¢ç©ï¼‰ã‚’æç”»ã™ã‚‹é–¢æ•°
            drawTrajectory() {
                if (this.trajectoryPoints.length < 2) return;
                
                // è»Œè·¡ã‚’è–„ã„è‰²ã§æç”»
                this.ctx.fillStyle = 'rgba(76, 175, 80, 0.1)'; // è–„ã„ç·‘è‰²
                this.ctx.strokeStyle = 'rgba(76, 175, 80, 0.3)'; // è–„ã„ç·‘è‰²ã®ç·š
                this.ctx.lineWidth = 1;
                
                // å„æ™‚ç‚¹ã§ã®æ­£æ–¹å½¢ã®è»Œè·¡ã‚’æç”»
                for (let i = 0; i < this.trajectoryPoints.length; i++) {
                    const point = this.trajectoryPoints[i];
                    const vertices = point.vertices;
                    
                    // æ­£æ–¹å½¢ã®è»Œè·¡ã‚’æç”»
                    this.ctx.beginPath();
                    this.ctx.moveTo(vertices[0].x, vertices[0].y);
                    for (let j = 1; j < vertices.length; j++) {
                        this.ctx.lineTo(vertices[j].x, vertices[j].y);
                    }
                    this.ctx.closePath();
                    this.ctx.fill();
                    this.ctx.stroke();
                }
            }
            
            drawSquare() {
                const vertices = this.getSquareVertices();
                const canvasVertices = vertices.map(v => this.toCanvasCoords(v.x, v.y));
                
                // æ­£æ–¹å½¢ã‚’æç”»ï¼ˆã‚°ãƒ¬ãƒ¼è‰²ã«å¤‰æ›´ï¼‰
                this.ctx.strokeStyle = '#666666';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.moveTo(canvasVertices[0].x, canvasVertices[0].y);
                for (let i = 1; i < canvasVertices.length; i++) {
                    this.ctx.lineTo(canvasVertices[i].x, canvasVertices[i].y);
                }
                this.ctx.closePath();
                this.ctx.stroke();
                
                // é ‚ç‚¹ã‚’æç”»ï¼ˆã‚°ãƒ¬ãƒ¼è‰²ã«å¤‰æ›´ï¼‰
                const labels = ['P', 'Q', 'R', 'S'];
                canvasVertices.forEach((vertex, index) => {
                    this.ctx.fillStyle = '#666666';
                    this.ctx.beginPath();
                    this.ctx.arc(vertex.x, vertex.y, 4, 0, 2 * Math.PI);
                    this.ctx.fill();
                    
                    this.ctx.fillStyle = '#000';
                    this.ctx.font = '12px Arial';
                    this.ctx.fillText(labels[index], vertex.x + 8, vertex.y + 5);
                });
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', () => {
            new SquareRotationVisualizer();
        });
    </script>
</body>
</html>
